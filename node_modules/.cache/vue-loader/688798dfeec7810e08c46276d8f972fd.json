{"remainingRequest":"/home/elaheh/Documents/University/Vue-Book-Land/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/elaheh/Documents/University/Vue-Book-Land/src/components/chat/Contacts.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/elaheh/Documents/University/Vue-Book-Land/src/components/chat/Contacts.vue","mtime":1630222369391},{"path":"/home/elaheh/Documents/University/Vue-Book-Land/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/elaheh/Documents/University/Vue-Book-Land/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/elaheh/Documents/University/Vue-Book-Land/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/elaheh/Documents/University/Vue-Book-Land/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG1hcEdldHRlcnMsIG1hcEFjdGlvbnMgfSBmcm9tICd2dWV4JwpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNvbnRhY3RzOiBbXSwKICAgICAgbGFzdE1lc3NhZ2VzOiBbXSwKICAgICAgY2hhdHM6IFtdLAogICAgICBpZHM6IFtdLAogICAgICB0aW1lcjogMCwKICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgIGZvbGxvd2luZzogW10KICAgIH0KICB9LAogIGFzeW5jIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmxvYWRpbmcgPSB0cnVlCiAgICB0aGlzLnRpbWVyID0gc2V0SW50ZXJ2YWwodGhpcy5nZXREYXRhLCAxMDAwKQogICAgdGhpcy5zZWxmID8gYXdhaXQgdGhpcy5nZXRDb250YWN0cygpIDogJycKICB9LAogIGNvbXB1dGVkOiB7CiAgICAuLi5tYXBHZXR0ZXJzKFsnc2VsZiddKQogIH0sCiAgbWV0aG9kczogewogICAgLi4ubWFwQWN0aW9ucyhbJ2hhbmRsZVJlcXVlc3QnXSksCiAgICBnZXREYXRhKCkgewogICAgICB0aGlzLmhhbmRsZVJlcXVlc3QoewogICAgICAgIG5hbWU6ICdjaGF0cy8nLAogICAgICAgIGFjdGlvbjogJ2dldEFsbCcKICAgICAgfSkudGhlbigocmVzKSA9PiB7CiAgICAgICAgdGhpcy5jaGF0cyA9IHJlcy5kYXRhLm1lc3NhZ2VzCiAgICAgICAgdGhpcy5zZXRDb250YWN0cygpCiAgICAgIH0pCiAgICB9LAogICAgc2V0Q29udGFjdHMoKSB7CiAgICAgIHRoaXMuY29udGFjdHMgPSBbXQogICAgICB0aGlzLmxhc3RNZXNzYWdlcyA9IFtdCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5jaGF0cy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICgKICAgICAgICAgIHRoaXMuY2hhdHNbaV0uc2VuZGVyLmlkICE9PSB0aGlzLnNlbGYuaWQgJiYKICAgICAgICAgIHRoaXMuY29udGFjdHMKICAgICAgICAgICAgLm1hcCgoZSkgPT4gewogICAgICAgICAgICAgIHJldHVybiBlLnBlcnNpYW5fdXNlcm5hbWUKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmluZGV4T2YodGhpcy5jaGF0c1tpXS5zZW5kZXIucGVyc2lhbl91c2VybmFtZSkgPCAwCiAgICAgICAgKSB7CiAgICAgICAgICB0aGlzLmNvbnRhY3RzLnB1c2godGhpcy5jaGF0c1tpXS5zZW5kZXIpCiAgICAgICAgICB0aGlzLmxhc3RNZXNzYWdlcy5wdXNoKHsKICAgICAgICAgICAgW3RoaXMuY2hhdHNbaV0uc2VuZGVyLnBlcnNpYW5fdXNlcm5hbWVdOiB0aGlzLmNoYXRzW2ldLnRleHQsCiAgICAgICAgICAgIHVzZXJfaWQ6IHRoaXMuY2hhdHNbaV0uc2VuZGVyLmlkLAogICAgICAgICAgICB1c2VyX25hbWU6IHRoaXMuY2hhdHNbaV0uc2VuZGVyLnBlcnNpYW5fdXNlcm5hbWUKICAgICAgICAgIH0pCiAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgIHRoaXMuY2hhdHNbaV0ucmVjZWl2ZXIuaWQgIT09IHRoaXMuc2VsZi5pZCAmJgogICAgICAgICAgdGhpcy5jb250YWN0cwogICAgICAgICAgICAubWFwKChlKSA9PiB7CiAgICAgICAgICAgICAgcmV0dXJuIGUucGVyc2lhbl91c2VybmFtZQogICAgICAgICAgICB9KQogICAgICAgICAgICAuaW5kZXhPZih0aGlzLmNoYXRzW2ldLnJlY2VpdmVyLnBlcnNpYW5fdXNlcm5hbWUpIDwgMAogICAgICAgICkgewogICAgICAgICAgdGhpcy5jb250YWN0cy5wdXNoKHRoaXMuY2hhdHNbaV0ucmVjZWl2ZXIpCiAgICAgICAgICB0aGlzLmxhc3RNZXNzYWdlcy5wdXNoKHsKICAgICAgICAgICAgW3RoaXMuY2hhdHNbaV0ucmVjZWl2ZXIucGVyc2lhbl91c2VybmFtZV06IHRoaXMuY2hhdHNbaV0udGV4dCwKICAgICAgICAgICAgdXNlcl9pZDogdGhpcy5jaGF0c1tpXS5yZWNlaXZlci5pZCwKICAgICAgICAgICAgdXNlcl9uYW1lOiB0aGlzLmNoYXRzW2ldLnNlbmRlci5wZXJzaWFuX3VzZXJuYW1lCiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZQogICAgfSwKICAgIHNldFJvdXRlKGluZGV4LCBpc0NoYXQgPSB0cnVlKSB7CiAgICAgIGlmIChpc0NoYXQpIHsKICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmxhc3RNZXNzYWdlc1tpbmRleF0pCiAgICAgICAgaWYgKHRoaXMubGFzdE1lc3NhZ2VzW2luZGV4XVsndXNlcl9pZCddICE9IHRoaXMuJHJvdXRlLnBhcmFtcy5pZCkgewogICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgICAgICBuYW1lOiAnQ2hhdElEJywKICAgICAgICAgICAgcGFyYW1zOiB7IGlkOiB0aGlzLmxhc3RNZXNzYWdlc1tpbmRleF1bJ3VzZXJfaWQnXSB9CiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7CiAgICAgICAgICBuYW1lOiAnQ2hhdElEJywKICAgICAgICAgIHBhcmFtczogeyBpZDogaW5kZXggfQogICAgICAgIH0pCiAgICAgIH0KICAgIH0sCiAgICBnZXRDb250YWN0cygpIHsKICAgICAgdGhpcy5oYW5kbGVSZXF1ZXN0KHsKICAgICAgICBuYW1lOiAndXNlcnMvZ2V0UmVsYXRpb25zaGlwcycsCiAgICAgICAgYWN0aW9uOiAnZ2V0QWxsJywKICAgICAgICBkYXRhOiB7CiAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICBmb2xsb3dpbmdfaWQ6IHRoaXMuc2VsZi5pZAogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSkudGhlbigocmVzKSA9PiB7CiAgICAgICAgdGhpcy5mb2xsb3dpbmcgPSByZXMuZGF0YS5yZWxhdGlvbnNoaXBzCiAgICAgIH0pCiAgICB9CiAgfSwKICBiZWZvcmVEZXN0cm95KCkgewogICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWVyKQogIH0sCiAgd2F0Y2g6IHsKICAgIHNlbGYoKSB7CiAgICAgIHRoaXMuZ2V0Q29udGFjdHMoKQogICAgfQogIH0KfQo="},{"version":3,"sources":["Contacts.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Contacts.vue","sourceRoot":"src/components/chat","sourcesContent":["<template>\n  <div class=\"contacts\" v-loading.fullscreen.lock=\"loading\">\n    <el-tabs type=\"border-card\">\n      <el-tab-pane :label=\"$t('messages')\">\n        <div class=\"items\">\n          <div\n            v-for=\"(c, index) in contacts\"\n            :key=\"c.id\"\n            :class=\"\n              `item ${c.id == Number($route.params.id) ? 'active-tab' : ''}`\n            \"\n            @click=\"setRoute(index)\"\n          >\n            <img\n              class=\"user-picture\"\n              v-if=\"c.image\"\n              :src=\"'http://ketabland.pythonanywhere.com' + c.image\"\n            />\n            <img\n              v-else\n              class=\"user-picture\"\n              src=\"https://img.icons8.com/cotton/64/000000/person-male--v2.png\"\n            />\n            <div>\n              <span class=\"detail\">{{ c.persian_username }}</span>\n              <div class=\"flexbox row-direction div-detail\">\n                <span class=\"detail\">\n                  {{\n                    c.persian_username !== lastMessages[index]['user_name']\n                      ? $t('you')\n                      : lastMessages[index]['user_name']\n                  }}:\n                </span>\n                <span class=\"detail\">\n                  {{ lastMessages[index][c.persian_username] }}\n                </span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </el-tab-pane>\n      <el-tab-pane :label=\"$t('following')\">\n        <div class=\"items\">\n          <div\n            v-for=\"c in following\"\n            :key=\"c.follower.id\"\n            class=\"item\"\n            @click=\"setRoute(c.follower.id, false)\"\n          >\n            <img\n              class=\"user-picture\"\n              v-if=\"c.follower.image\"\n              :src=\"'http://ketabland.pythonanywhere.com' + c.follower.image\"\n            />\n            <img\n              v-else\n              class=\"user-picture\"\n              src=\"https://img.icons8.com/cotton/64/000000/person-male--v2.png\"\n            />\n            <div>\n              <span class=\"detail user-detail\">{{\n                c.follower.persian_username\n              }}</span>\n            </div>\n          </div>\n        </div>\n      </el-tab-pane>\n    </el-tabs>\n    <!-- <el-card>\n      <div slot=\"header\" class=\"clearfix\">\n        <span>{{ $t('contacts') }}</span>\n      </div>\n      \n    </el-card> -->\n  </div>\n</template>\n\n<script>\n  import { mapGetters, mapActions } from 'vuex'\n  export default {\n    data() {\n      return {\n        contacts: [],\n        lastMessages: [],\n        chats: [],\n        ids: [],\n        timer: 0,\n        loading: false,\n        following: []\n      }\n    },\n    async created() {\n      this.loading = true\n      this.timer = setInterval(this.getData, 1000)\n      this.self ? await this.getContacts() : ''\n    },\n    computed: {\n      ...mapGetters(['self'])\n    },\n    methods: {\n      ...mapActions(['handleRequest']),\n      getData() {\n        this.handleRequest({\n          name: 'chats/',\n          action: 'getAll'\n        }).then((res) => {\n          this.chats = res.data.messages\n          this.setContacts()\n        })\n      },\n      setContacts() {\n        this.contacts = []\n        this.lastMessages = []\n        for (let i = 0; i < this.chats.length; i++) {\n          if (\n            this.chats[i].sender.id !== this.self.id &&\n            this.contacts\n              .map((e) => {\n                return e.persian_username\n              })\n              .indexOf(this.chats[i].sender.persian_username) < 0\n          ) {\n            this.contacts.push(this.chats[i].sender)\n            this.lastMessages.push({\n              [this.chats[i].sender.persian_username]: this.chats[i].text,\n              user_id: this.chats[i].sender.id,\n              user_name: this.chats[i].sender.persian_username\n            })\n          } else if (\n            this.chats[i].receiver.id !== this.self.id &&\n            this.contacts\n              .map((e) => {\n                return e.persian_username\n              })\n              .indexOf(this.chats[i].receiver.persian_username) < 0\n          ) {\n            this.contacts.push(this.chats[i].receiver)\n            this.lastMessages.push({\n              [this.chats[i].receiver.persian_username]: this.chats[i].text,\n              user_id: this.chats[i].receiver.id,\n              user_name: this.chats[i].sender.persian_username\n            })\n          }\n        }\n        this.loading = false\n      },\n      setRoute(index, isChat = true) {\n        if (isChat) {\n          console.log(this.lastMessages[index])\n          if (this.lastMessages[index]['user_id'] != this.$route.params.id) {\n            this.$router.push({\n              name: 'ChatID',\n              params: { id: this.lastMessages[index]['user_id'] }\n            })\n          }\n        } else {\n          this.$router.push({\n            name: 'ChatID',\n            params: { id: index }\n          })\n        }\n      },\n      getContacts() {\n        this.handleRequest({\n          name: 'users/getRelationships',\n          action: 'getAll',\n          data: {\n            query: {\n              following_id: this.self.id\n            }\n          }\n        }).then((res) => {\n          this.following = res.data.relationships\n        })\n      }\n    },\n    beforeDestroy() {\n      clearInterval(this.timer)\n    },\n    watch: {\n      self() {\n        this.getContacts()\n      }\n    }\n  }\n</script>\n"]}]}